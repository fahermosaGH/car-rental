<section class="confirmacion-page">
  <ng-container *ngIf="!loading && reserva; else loadingTpl">
    <header class="conf-header">
      <div class="icon-ok">✅</div>
      <div>
        <h1>Reserva creada correctamente</h1>
        <p>Tu código de reserva es <strong>#{{ reserva.id }}</strong>.</p>
      </div>
    </header>

    <div class="conf-layout">
      
      <!-- Panel Izquierdo -->
      <article class="conf-detalle">
        <h2>{{ reserva.vehicleName }}</h2>
        <p class="categoria">{{ reserva.category || 'Sin categoría' }}</p>

        <div class="fila">
          <div>
            <h3>Retiro</h3>
            <p>{{ reserva.startAt | date: 'dd/MM/yyyy' }}</p>
            <p>{{ reserva.pickupLocationName }}</p>
          </div>

          <div>
            <h3>Devolución</h3>
            <p>{{ reserva.endAt | date: 'dd/MM/yyyy' }}</p>
            <p>{{ reserva.dropoffLocationName }}</p>
          </div>
        </div>

        <div class="fila">
          <div>
            <h3>Estado</h3>
            <p>{{ reserva.status | titlecase }}</p>
          </div>

          <div>
            <h3>Total</h3>
            <p>{{ reserva.totalPrice || 0 | currency: 'ARS' }}</p>
          </div>
        </div>

        <!-- ⭐ CALIFICACIÓN SOLO SI FINALIZADA -->
        <section 
          class="rating-box" 
          *ngIf="estadoDesdeMisReservas === 'Finalizada'"
        >
          <h3>Calificá tu experiencia</h3>

          <!-- ESTRELLAS CLICKEABLES -->
          <div class="stars">
            <span 
              *ngFor="let s of [1,2,3,4,5]"
              class="star"
              [class.filled]="rating >= s"
              (click)="setRating(s)"
            >
              ★
            </span>
          </div>

          <textarea
            [(ngModel)]="ratingComment"
            placeholder="Comentario opcional..."
            rows="3"
            class="rating-comment"
          ></textarea>

          <button 
            class="btn-rate" 
            (click)="guardarRating()" 
            [disabled]="ratingEnviando"
          >
            {{ ratingEnviando ? 'Guardando...' : 'Guardar calificación' }}
          </button>

          <p class="rating-msg" *ngIf="ratingMensaje">{{ ratingMensaje }}</p>
          <p class="rating-error" *ngIf="ratingError">{{ ratingError }}</p>
        </section>

      </article>

      <!-- Panel Derecho -->
      <aside class="conf-comprobante">
        <h2>Comprobante de reserva</h2>
        <p>Ingresá un correo electrónico para recibir el comprobante.</p>

        <input
          type="email"
          [(ngModel)]="emailComprobante"
          placeholder="tu-correo@ejemplo.com"
        />

        <button
          type="button"
          class="btn-primary"
          (click)="enviarComprobante()"
          [disabled]="enviando"
        >
          {{ enviando ? 'Enviando...' : 'Enviar comprobante' }}
        </button>

        <p class="msg-ok" *ngIf="mensajeEnvio">{{ mensajeEnvio }}</p>
        <p class="msg-error" *ngIf="errorEnvio">{{ errorEnvio }}</p>

        <div class="acciones">
          <button type="button" (click)="volverACotizar()">← Volver a cotizar</button>
          <button type="button" (click)="irAMisReservas()">Ver mis reservas</button>
        </div>
      </aside>

    </div>
  </ng-container>

  <ng-template #loadingTpl>
    <div class="loading">Cargando reserva...</div>
  </ng-template>

  <div *ngIf="!loading && error" class="error">
    {{ error }}
  </div>
</section>
