<section class="confirmacion-page">
  <ng-container *ngIf="!loading && reserva; else loadingTpl">
    <header class="conf-header">
      <div class="icon-ok">‚úÖ</div>
      <div>
        <h1>Reserva creada correctamente</h1>
        <p>Tu c√≥digo de reserva es <strong>#{{ reserva.id }}</strong>.</p>
      </div>
    </header>

    <div class="conf-layout">

      <!-- Panel Izquierdo -->
      <article class="conf-detalle">
        <h2>{{ reserva.vehicleName }}</h2>
        <p class="categoria">{{ reserva.category || 'Sin categor√≠a' }}</p>

        <div class="fila">
          <div>
            <h3>Retiro</h3>
            <p>{{ reserva.startAt | date: 'dd/MM/yyyy' }}</p>
            <p>{{ reserva.pickupLocationName }}</p>
          </div>

          <div>
            <h3>Devoluci√≥n</h3>
            <p>{{ reserva.endAt | date: 'dd/MM/yyyy' }}</p>
            <p>{{ reserva.dropoffLocationName }}</p>
          </div>
        </div>

        <div class="fila">
          <div>
            <h3>Estado</h3>
            <p>{{ reserva.status | titlecase }}</p>
          </div>

          <div>
            <h3>Total</h3>
            <p>{{ reserva.totalPrice || 0 | currency: 'ARS' }}</p>
          </div>
        </div>

        <!-- ‚≠ê CALIFICACI√ìN SOLO SI FINALIZADA -->
        <section class="rating-box" *ngIf="estadoDesdeMisReservas === 'Finalizada'">
          <h3>Calific√° tu experiencia</h3>

          <!-- ESTRELLAS CLICKEABLES -->
          <div class="stars">
            <span *ngFor="let s of [1,2,3,4,5]" class="star" [class.filled]="rating >= s" (click)="setRating(s)">
              ‚òÖ
            </span>
          </div>

          <textarea [(ngModel)]="ratingComment" placeholder="Comentario opcional..." rows="3"
            class="rating-comment"></textarea>

          <button class="btn-rate" (click)="guardarRating()" [disabled]="ratingEnviando">
            {{ ratingEnviando ? 'Guardando...' : 'Guardar calificaci√≥n' }}
          </button>

          <p class="rating-msg" *ngIf="ratingMensaje">{{ ratingMensaje }}</p>
          <p class="rating-error" *ngIf="ratingError">{{ ratingError }}</p>
        </section>

        <!-- üïí Horarios de retiro y devoluci√≥n -->
        <section class="horarios">
          <h3>üïí Horarios de retiro y devoluci√≥n</h3>
          <p>Las reservas se manejan por d√≠a completo.</p>
          <p>
            El retiro y la devoluci√≥n del veh√≠culo se realizan entre las
            09:00 y las 18:00 hs en la sucursal seleccionada.
          </p>
          <p>
            Si necesit√°s coordinar un horario especial, comunicate con
            <a routerLink="/atencion-al-cliente" class="link-atencion">
              Atenci√≥n al Cliente
            </a>.
          </p>
        </section>


      </article>

      <!-- Panel Derecho -->
      <aside class="conf-comprobante">
        <h2>Comprobante de reserva</h2>
        <p>Ingres√° un correo electr√≥nico para recibir el comprobante.</p>

        <input
          type="email"
          [(ngModel)]="emailComprobante"
          placeholder="tu-correo@ejemplo.com"
        />

        <button
          type="button"
          class="btn-primary"
          (click)="enviarComprobante()"
          [disabled]="enviando"
        >
          {{ enviando ? 'Enviando...' : 'Enviar comprobante' }}
        </button>

        <!-- üîπ Nuevo bot√≥n: imprimir / guardar como PDF -->
        <button
          type="button"
          class="btn-secondary"
          (click)="imprimirComprobante()"
        >
          Imprimir / guardar comprobante
        </button>

        <p class="msg-ok" *ngIf="mensajeEnvio">{{ mensajeEnvio }}</p>
        <p class="msg-error" *ngIf="errorEnvio">{{ errorEnvio }}</p>

        <div class="acciones">
          <button type="button" (click)="volverACotizar()">‚Üê Volver a cotizar</button>
          <button type="button" (click)="irAMisReservas()">Ver mis reservas</button>
        </div>
      </aside>

    </div>
  </ng-container>

  <ng-template #loadingTpl>
    <div class="loading">Cargando reserva...</div>
  </ng-template>

  <div *ngIf="!loading && error" class="error">
    {{ error }}
  </div>
</section>