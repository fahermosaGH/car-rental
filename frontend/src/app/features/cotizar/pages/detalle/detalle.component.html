<section class="detalle-page" *ngIf="vehiculo; else loadingTpl">
  <!-- Barra superior: volver + badge de disponibilidad -->
  <header class="detalle-header">
    <button class="btn-back" routerLink="/cotizar/resultados">
      ‚Üê Volver a resultados
    </button>

    <div class="header-right">
      <span
        *ngIf="checking"
        class="chip chip-warning"
      >
        ‚è≥ Verificando disponibilidad...
      </span>

      <span
        *ngIf="!checking && unitsAvailable !== undefined"
        class="chip"
        [class.chip-ok]="unitsAvailable > 0"
        [class.chip-error]="unitsAvailable <= 0"
      >
        {{
          unitsAvailable > 0
            ? ('Quedan ' + unitsAvailable + ' unidad' + (unitsAvailable > 1 ? 'es' : ''))
            : 'Sin stock'
        }}
      </span>
    </div>
  </header>

  <!-- Layout principal: info a la izquierda, resumen a la derecha -->
  <div class="detalle-layout">
    <!-- Panel principal del veh√≠culo -->
    <article class="panel panel-main">
      <div class="hero-image">
        <img [src]="vehiculo!.img" [alt]="vehiculo!.name" />
      </div>

      <div class="main-body">
        <div class="title-row">
          <div>
            <h1>{{ vehiculo!.name }}</h1>
            <p class="categoria">
              {{ vehiculo!.category || 'Sin categor√≠a' }}
            </p>
          </div>
        </div>

        <div class="meta-row">
          <span *ngIf="vehiculo!.transmission">
            ‚öôÔ∏è {{ vehiculo!.transmission | titlecase }}
          </span>
          <span *ngIf="vehiculo!.fuel">
            ‚õΩ {{ vehiculo!.fuel }}
          </span>
        </div>

        <section class="block">
          <h2>Descripci√≥n</h2>
          <p>
            {{ vehiculo!.description || 'Veh√≠culo c√≥modo y seguro para tu pr√≥ximo viaje.' }}
          </p>
        </section>

        <section class="block block-tarifa">
          <div class="tarifa-header">
            <div>
              <span class="label">Tarifa diaria</span>
              <div class="tarifa-valor">
                {{ vehiculo!.dailyRate | currency:'ARS' }}
              </div>
            </div>
            <div class="tarifa-info">
              <span class="dias">
                {{ dias }} {{ dias === 1 ? 'd√≠a' : 'd√≠as' }}
              </span>
            </div>
          </div>
        </section>

        <section class="block">
          <h2>Extras disponibles</h2>
          <div class="extras-grid">
            <label class="extra-item">
              <input
                type="checkbox"
                [(ngModel)]="extras.seguro"
                (change)="actualizarTotal()"
              />
              <div class="extra-content">
                <span class="extra-title">Seguro</span>
                <span class="extra-sub">
                  Proteg√© tu viaje (+{{ preciosExtras.seguro | currency:'ARS' }})
                </span>
              </div>
            </label>

            <label class="extra-item">
              <input
                type="checkbox"
                [(ngModel)]="extras.silla"
                (change)="actualizarTotal()"
              />
              <div class="extra-content">
                <span class="extra-title">Silla para ni√±o</span>
                <span class="extra-sub">
                  Ideal para viajar en familia (+{{ preciosExtras.silla | currency:'ARS' }})
                </span>
              </div>
            </label>

            <label class="extra-item">
              <input
                type="checkbox"
                [(ngModel)]="extras.gps"
                (change)="actualizarTotal()"
              />
              <div class="extra-content">
                <span class="extra-title">GPS</span>
                <span class="extra-sub">
                  Lleg√° sin perderte (+{{ preciosExtras.gps | currency:'ARS' }})
                </span>
              </div>
            </label>
          </div>
        </section>
      </div>
    </article>

    <!-- Panel lateral: resumen de reserva -->
    <aside class="panel panel-resumen">
      <h2>Resumen de tu reserva</h2>

      <div class="resumen-row fechas" *ngIf="startAt && endAt">
        <div>
          <span class="label">Retiro</span>
          <strong>{{ startAt | date:'dd/MM/yyyy' }}</strong>
        </div>
        <div>
          <span class="label">Devoluci√≥n</span>
          <strong>{{ endAt | date:'dd/MM/yyyy' }}</strong>
        </div>
      </div>

      <div class="resumen-row">
        <div>
          <span class="label">Sucursal de retiro</span>
          <strong>#{{ pickupLocationId }}</strong>
        </div>
        <div>
          <span class="label">Cantidad de d√≠as</span>
          <strong>{{ dias }}</strong>
        </div>
      </div>

      <div class="resumen-precio">
        <div class="line">
          <span>Base (tarifa diaria x {{ dias }})</span>
          <span>{{ (vehiculo!.dailyRate * dias) | currency:'ARS' }}</span>
        </div>

        <div class="line">
          <span>Extras seleccionados</span>
          <span>+ {{ (total - vehiculo!.dailyRate * dias) | currency:'ARS' }}</span>
        </div>

        <div class="total-line">
          <span>Total estimado</span>
          <strong>{{ total | currency:'ARS' }}</strong>
        </div>
      </div>

      <p class="nota">
        El precio final puede variar seg√∫n impuestos o cargos locales en la sucursal.
      </p>

      <p *ngIf="errorMsg" class="error-msg">
        {{ errorMsg }}
      </p>

      <button
        class="btn-primary"
        [disabled]="botonDeshabilitado"
        (click)="confirmarReserva()"
      >
        {{ creating ? 'Creando reserva...' : 'Confirmar reserva' }}
      </button>
    </aside>
  </div>
</section>

<!-- Template de carga -->
<ng-template #loadingTpl>
  <div class="loading">
    üöò Cargando informaci√≥n del veh√≠culo...
  </div>
</ng-template>
