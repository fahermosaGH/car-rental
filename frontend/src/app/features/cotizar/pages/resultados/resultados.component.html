<section class="resultados-page">
  <header class="resultados-header">
    <div class="header-text">
      <h1>VehÃ­culos disponibles</h1>

      <p *ngIf="cargando">ğŸš— Buscando las mejores opciones para tu viaje...</p>

      <p *ngIf="!cargando && resultados.length">
        Encontramos <strong>{{ resultados.length }}</strong>
        {{ resultados.length === 1 ? 'opciÃ³n' : 'opciones' }} para tu bÃºsqueda.
      </p>

      <p *ngIf="!cargando && !resultados.length">
        ğŸ˜• No encontramos vehÃ­culos para esa bÃºsqueda. ProbÃ¡ cambiar las fechas o la
        sucursal.
      </p>
    </div>

    <div class="header-summary" *ngIf="!cargando && startAt && endAt">
      <span class="summary-chip">
        ğŸ“… {{ dias }} {{ dias === 1 ? 'dÃ­a' : 'dÃ­as' }}
      </span>
      <span class="summary-chip">
        ğŸš˜ Retiro #{{ pickupLocationId }}
      </span>
    </div>
  </header>

  <div class="layout">
    <aside class="sidebar">
      <h3 class="sidebar-title">Filtrar por categorÃ­a</h3>

      <ul class="cat-list">
        <li *ngFor="let cat of availableCategories">
          <button
            type="button"
            class="cat-chip"
            [class.active]="selectedCategory === cat"
            (click)="cambiarCategoria(cat)"
            [attr.aria-pressed]="selectedCategory === cat"
          >
            {{ cat }}
          </button>
        </li>
      </ul>

      <div class="sidebar-order" *ngIf="resultados.length">
        <h4>Ordenar por precio</h4>
        <div class="order-buttons">
          <button
            class="btn-sort"
            [class.active]="order === 'asc'"
            (click)="ordenarPorPrecio('asc')"
          >
            Menor â†’ Mayor
          </button>
          <button
            class="btn-sort"
            [class.active]="order === 'desc'"
            (click)="ordenarPorPrecio('desc')"
          >
            Mayor â†’ Menor
          </button>
        </div>
      </div>
    </aside>

    <main class="content">
      <div class="toolbar" *ngIf="resultados.length">
        <div class="toolbar-left">
          <span
            class="toolbar-pill"
            *ngIf="selectedCategory && selectedCategory !== 'Todos'"
          >
            {{ selectedCategory }}
          </span>
          <span class="toolbar-count">
            {{ resultados.length }}
            {{ resultados.length === 1 ? 'resultado' : 'resultados' }}
          </span>
        </div>

        <div class="toolbar-right">
          <span>Ordenar por precio:</span>
          <button
            class="btn-sort"
            [class.active]="order === 'asc'"
            (click)="ordenarPorPrecio('asc')"
          >
            Menor â†’ Mayor
          </button>
          <button
            class="btn-sort"
            [class.active]="order === 'desc'"
            (click)="ordenarPorPrecio('desc')"
          >
            Mayor â†’ Menor
          </button>
        </div>
      </div>

      <div *ngIf="cargando" class="state state-loading">
        <span class="spinner"></span>
        <p>Consultando disponibilidad en tiempo real...</p>
      </div>

      <div *ngIf="!cargando && resultados.length === 0" class="state state-empty">
        <p>ğŸ˜• No encontramos vehÃ­culos para esa combinaciÃ³n.</p>
        <p class="hint">ProbÃ¡ cambiar fechas o sucursal.</p>
      </div>

      <div class="grid" *ngIf="!cargando && resultados.length">
        <article class="card" *ngFor="let auto of resultados">
          <div class="card-media">
            <img [src]="auto.img" [alt]="auto.name" />
            <span
              *ngIf="auto.unitsAvailable !== undefined"
              class="badge-disponibles"
              [class.no-stock]="auto.unitsAvailable <= 0"
            >
              {{
                auto.unitsAvailable > 0
                  ? 'Quedan ' + auto.unitsAvailable
                  : 'Sin stock'
              }}
            </span>
          </div>

          <div class="card-body">
            <div class="card-header-row">
              <div class="title-block">
                <h3>{{ auto.name }}</h3>
                <span class="chip-categoria">{{ auto.category }}</span>
              </div>

              <div class="price-block">
                <span class="price-label">por dÃ­a desde</span>
                <div class="price-value">
                  {{ auto.dailyRate | currency: 'ARS' }}
                </div>
              </div>
            </div>

            <div class="card-meta">
              <span *ngIf="auto.year">ğŸ“† {{ auto.year }}</span>
              <span *ngIf="auto.seats">ğŸ§â€â™‚ï¸ {{ auto.seats }} asientos</span>
              <span *ngIf="auto.transmission">
                âš™ï¸ {{ auto.transmission | titlecase }}
              </span>
            </div>

            <div class="card-total">
              <span>
                Total por {{ dias }} {{ dias === 1 ? 'dÃ­a' : 'dÃ­as' }}
              </span>
              <strong>
                {{ calcularTotal(auto.dailyRate) | currency: 'ARS' }}
              </strong>
            </div>

            <button
              class="btn-ver-detalle"
              [disabled]="
                auto.unitsAvailable !== undefined && auto.unitsAvailable <= 0
              "
              (click)="verDetalle(auto.id)"
            >
              {{
                auto.unitsAvailable !== undefined && auto.unitsAvailable <= 0
                  ? 'No disponible'
                  : 'Ver detalle'
              }}
            </button>
          </div>
        </article>
      </div>
    </main>
  </div>
</section>