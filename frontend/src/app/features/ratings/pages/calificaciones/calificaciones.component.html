<section class="page">
  <header class="head">
    <div>
      <h1>Calificaciones</h1>
      <p class="muted">
        Ranking de vehÃ­culos por promedio de reseÃ±as y cantidad de opiniones.
      </p>
    </div>

    <div class="actions">
      <div class="search">
        <input
          type="text"
          placeholder="Buscar por marca, modelo o categorÃ­aâ€¦"
          [(ngModel)]="q"
          (input)="apply()"
        />
      </div>

      <div class="sort">
        <button
          type="button"
          class="chip"
          [class.active]="sort === 'best'"
          (click)="setSort('best')"
        >
          â­ Mejor puntuaciÃ³n
        </button>

        <button
          type="button"
          class="chip"
          [class.active]="sort === 'mostReviewed'"
          (click)="setSort('mostReviewed')"
        >
          ğŸ’¬ MÃ¡s reseÃ±as
        </button>

        <button type="button" class="chip ghost" (click)="load()">
          â†» Recargar
        </button>
      </div>
    </div>
  </header>

  <div *ngIf="loading" class="state">Cargando rankingâ€¦</div>
  <div *ngIf="!loading && error" class="alert">{{ error }}</div>

  <div *ngIf="!loading && !error && filtered.length === 0" class="state">
    No hay vehÃ­culos para mostrar.
  </div>

  <div class="grid" *ngIf="!loading && !error && filtered.length">
    <article class="card" *ngFor="let v of filtered; let i = index">
      <div class="rank">#{{ i + 1 }}</div>

      <div class="media" *ngIf="v.__img">
        <img [src]="v.__img" [alt]="v.__name" />
      </div>

      <div class="body">
        <div class="title-row">
          <div>
            <h3>{{ v.__name }}</h3>
            <span class="pill">{{ v.category || 'Sin categorÃ­a' }}</span>
          </div>

          <div class="score">
            <div class="avg">{{ avgText(v) }}</div>

            <div class="stars" aria-label="rating">
              <span
                *ngFor="let s of starsArray()"
                class="star"
                [class.filled]="isStarFilled(v, s)"
              >
                â˜…
              </span>
            </div>

            <div class="cnt">{{ cntOf(v) }} reseÃ±as</div>
          </div>
        </div>

        <div class="meta">
          <span *ngIf="v.year">ğŸ“† {{ v.year }}</span>
          <span *ngIf="v.seats">ğŸ§ {{ v.seats }} asientos</span>
          <span *ngIf="v.transmission">âš™ï¸ {{ v.transmission | titlecase }}</span>
        </div>

        <div class="cta">
          <a class="btn" [routerLink]="['/calificaciones', v.id]">Ver reseÃ±as</a>
        </div>

        <div class="note" *ngIf="avgOf(v) == null">
          Sin reseÃ±as todavÃ­a. (Queda al final del ranking)
        </div>
      </div>
    </article>
  </div>
</section>